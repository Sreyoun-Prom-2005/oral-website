<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/navbar.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <header>
        <div class="navbar">
            <a href="{{ url_for('index') }}" class="active">Home</a>
            <a href="{{ url_for('about') }}">About</a>
            <a href="{{ url_for('products') }}">Products</a>
            <a href="{{ url_for('contact') }}" class="center">Contact</a>
            <a href="{{ url_for('login') }}" class="right">Login</a>
            <a href="{{ url_for('cart') }}" class="right">
                <i class="fas fa-shopping-cart"></i> Cart
            </a>
            <form class="search-form" action="{{ url_for('search') }}" method="get">
                <input type="text" name="query" placeholder="Search..." />
                <button type="submit"><i class="fas fa-search"></i></button>
            </form>
        </div>
        
    </header>

    <h1>Checkout</h1>
    <div id="checkout-container">
        <!-- This will be populated with JavaScript -->
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            const checkoutContainer = document.getElementById('checkout-container');

            if (cart.length === 0) {
                checkoutContainer.innerHTML = '<p>Your cart is empty!</p>';
                return;
            }

            let total = 0;
            cart.forEach(item => {
                const productElement = document.createElement('div');
                productElement.className = 'checkout-item';
                productElement.innerHTML = `
                    <p>Product ID: ${item.id}</p>
                    <p>Quantity: ${item.quantity}</p>
                `;
                checkoutContainer.appendChild(productElement);

                // Assuming you have a function getProductPrice that takes a product ID and returns its price
                const price = getProductPrice(item.id);
                total += price * item.quantity;
            });

            const totalElement = document.createElement('div');
            totalElement.className = 'checkout-total';
            totalElement.innerHTML = `<p>Total: $${total.toFixed(2)}</p>`;
            checkoutContainer.appendChild(totalElement);

            const submitButton = document.createElement('button');
            submitButton.textContent = 'Submit Order';
            submitButton.addEventListener('click', submitOrder);
            checkoutContainer.appendChild(submitButton);
        });

        function getProductPrice(productId) {
            // This function should return the price of the product based on its ID
            // For simplicity, we'll assume a fixed price for demonstration purposes
            return 10.00; // Replace with actual price fetching logic
        }

        function submitOrder() {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            fetch('/submit-order', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ cart })
            })
            .then(response => response.json())
            .then(data => {
                alert('Order submitted successfully!');
                // Clear cart
                localStorage.removeItem('cart');
                // Redirect to a success page or homepage
                window.location.href = "{{ url_for('index') }}";
            })
            .catch(error => {
                console.error('Error:', error);
                alert('There was an error submitting your order. Please try again.');
            });
        }
    </script>
</body>
</html>
